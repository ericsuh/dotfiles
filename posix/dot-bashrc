# History settings
shopt -s histappend # append, don't overwrite history
export PROMPT_COMMAND="history -a${PROMPT_COMMAND:+; PROMPT_COMMAND}" #write history when displaying prompt
export LC_CTYPE=en_US.UTF-8 # For possible non-ASCII filenames

# Set up SSH settings

SSH_ENV="$HOME/.ssh/environment"

export SSH_AUTH_SOCK="$XDG_RUNTIME_DIR/ssh-agent.socket"
function start_agent {
	/usr/bin/ssh-agent | sed 's/^echo/#echo/' > "${SSH_ENV}"
	chmod 600 "${SSH_ENV}"
	. "${SSH_ENV}" > /dev/null
	/usr/bin/ssh-add;
}

# if [ -f "${SSH_ENV}" ]; then
#		. "${SSH_ENV}" > /dev/null
#		ps ${SSH_AGENT_PID} doesn't work under cywgin
#		ps -ef | grep ${SSH_AGENT_PID} | grep ssh-agent$ > /dev/null || {
#			start_agent;
#		}
# else
#    start_agent;
# fi

if [[ -z "$SSH_CLIENT" ]]; then
    # local connection, change prompt
    #
    # Coloration of Command Prompt and 'ls'
    # includes magic sequence \033k\033\\ at beginning
    # for the purposes of `screen` and \033[7h
    # to allow for good line wrapping
    export PS1="\[\033k\033\\\033[7h\]\W \\$ "
    export PS1="\[\e[1;30m\]\W\[\e[m\] \\$ "
else
    # ssh connection, print hostname and os version
    echo "Welcome to $(scutil --get ComputerName) ($(sw_vers -productVersion))"
fi
export CLICOLOR=1
export FZF_DEFAULT_COMMAND='rg --files --hidden'

source ${HOME}/.bash_aliases
source ~/.git-completion.bash

if [ -e "${HOME}/.bashrc_os" ];    then source "${HOME}/.bashrc_os"; fi
if [ -e "${HOME}/.bashrc_local" ]; then source "${HOME}/.bashrc_local"; fi

# The next line enables shell command completion for gcloud.
if [ -f "${HOME}/google-cloud-sdk/completion.bash.inc" ]; then . "${HOME}/google-cloud-sdk/completion.bash.inc"; fi

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion

[ -f ~/.fzf.bash ] && source ~/.fzf.bash
. "$HOME/.cargo/env"
